2.1.1.2 前端 API 
为了辅助完成「授权」和「数据配置」界面的开发，我们提供了「前端 SDK」 用于一些必要信息的查询和写入。
1. 通过以下命令在你的前端项目中安装前端 SDK：
npm i @lark-base-open/connector-api@latest
2. 前端 SDK 拥有统一入口 bitable，通过以下方式进行引入：
import { bitable } from '@lark-base-open/connector-api';
同步配置接口
- getConfig
获取指定同步表已保存的配置，在修改同步表配置时，可使用该 API 拿到所需的配置。
bitable.getConfig(): Promise<Record<string, any>>;
- saveConfigAndGoNext
保存当前数据同步配置，配置信息的结构由开发者自定义，格式为 key-value 的形式。通常该 API 需要在用户配置完成后调用，调用该 API 后会关闭当前插件窗口并进入同步字段配置。
bitable.saveConfigAndGoNext(configData: Record<string, any>): Promise<void>;
环境信息接口
- getBaseUserId
获取当前用户的唯一标识，该用户标识在不同插件点位（侧边栏、连接器、视图等）中均唯一，通常插件需要将该用户标识与三方授权结果进行绑定。
该接口返回的用户 ID 与飞书开放平台的 OpenUserId 并不通用，请勿将其作为全平台的唯一 id。
bitable.getBaseUserId(): Promise<string>;
- getTenantKey
获取当前用户的租户唯一标识（当前仅支持 base 中使用该API，不支持在 wiki 中使用）
bitable.getTenantKey(): Promise<string>;


2.1.2 后端接口开发
后端 Node.js 模板：https://replit.com/@lark-base/data-sync-be-demo
暂时无法在飞书文档外展示此内容
2.1.2.1 插件配置接口(meta.json)
每个连接器项目都需要在服务访问地址根目录下提供一个静态资源 meta.json 访问路径，用来返回插件的元信息，这些元信息告知 Base 以下信息：
- 插件前端的加载地址、UI配置信息
- 插件服务端的表结构、数据获取接口地址
内容示例可参考 https://replit.com/@lark-base/data-sync-be-demo#public/meta.json
接口协议
说明
该接口主要返回插件的一些元信息，例如前端服务地址、UI配置、后端接口的相对路径等
方法
GET
URI
http://应用服务地址/meta.json 
如应用服务地址是： https://integration-test-demo.feishu-base.repl.co （填入到运行地址的时候，注意不能有/后缀）
则请求meta.json为： https://integration-test-demo.feishu-base.repl.co/meta.json
超时限制
10 秒
meta.json 的结构如下，请参考下面的格式返回
{
  "schemaVersion": 1,// 不能缺少
  "version": "1.0.0",// 不能缺少
  "type": "data_connector",// 固定值，不能缺少
  "extraData": {
    "disabledPeriodicSync": false,
    
    // 此属性返回的不能是http，必须是https，否则会被浏览器安全策略拦截
    "dataSourceConfigUiUri": "https://ext.baseopendev.com/ext/data-sync-fe-demo/c70fa2864a002386423f26411f21a3c674bc2f9c/index.html", // 前端配置界面 URL
    "initHeight": 300, // 初始化的配置窗口内容高度，最小226，最大606
    "initWidth": 520, // 初始化的配置窗口内容宽度，最小420，最大840
  },
  "protocol": {
    "type": "http",// 固定值，不能缺少
    "httpProtocol": {
      "uris": [
          {
            "type": "tableMeta",
            "uri": "/api/table_meta" // 表结构接口路径
          },
          {
            "type": "records",
            "uri": "/api/records" // 表记录接口路径
          }
      ]
    }
  }
}
特别说明：
- dataSourceConfigUiUri 指的是数据同步插件 UI 界面的访问地址。以示例代码为例，即 Replit 前端项目启动后的运行地址
- 对于httpProtocol中的uris列表会进行参数校验，校验uri值不为空
2.1.2.2 表结构接口
表结构接口 Node.js 版本的实现可参考 https://replit.com/@lark-base/data-sync-be-demo#table_meta.js
接口协议
基本信息
说明
该接口返回 数据源的表结构，指明数据源的数据有哪些字段，每个字段是什么类型
方法
POST
URI
与 meta.json 中的 tableMetaURI 一致
超时限制
10 秒
demo地址
https://replit.com/@Feishu-Base/integration-test-demo#pages/api/table_meta.ts
请求头
Key
value 描述
X-Base-Request-Timestamp

签名信息，详看下文「请求签名」逻辑


X-Base-Request-Nonce
签名信息，详看下文「请求签名」逻辑
Content-Type
固定值："application/json; charset=utf-8"
请求体
参数名
类型
描述
params
string
- 查询参数，值为 json 字符串，结构：
{
  datasourceConfig: string // 用户在数据源配置页面选择的配置信息，也就是前端调用前端sdk bitable.saveConfigAndGoNext(configData: Record<string, any>)保存的信息，值由开发者定义，服务端在请求插件服务接口时透传
}
context

string
- 系统参数，值为 json 字符串，结构：
{
    bitable: {
        token: string; //  Base token
        logID: string; // 请求日志 id
    },
    packID: string;
    type: string， // 插件类型： script、plugin
    tenantKey: string, // 租户标识
    userTenantKey: string; // 用户所属租户的租户标识
    bizInstanceID: string // 插件业务实例ID, 当值为0时，代表在还没有创建的情况下请求 表结构接口
    scriptArgs: {
        projectURL: string
        baseOpenID: string, // 用户身份标识，也就是通过前端sdk bitable.getUserId()拿到的id
   }
}
请求体示例
{
  "params":"{\"datasourceConfig\":\"{\"xxx\":\"yyy\"}\"}", 
  "context": "{}"  
}

response body
参数名
类型
是否必填
校验规则
描述
code
int
是

0 代表成功，非 0 则是异常错误码，规定的错误码场景：
1254400: 配置错误，即用户在配置面板选择的值不合法可以返回该错误码
1254403：用户访问权限异常
1254500：系统异常，插件运行错误
1254501：限流异常
1254505：付费错误异常
具体的错误信息，在msg 字段中返回
msg
string 
否

注意：msg 的格式为 json 字符串，里面需要包含 中英文的错误信息，当发生异常时，开发者需要同时返回这两种语言的信息，这样连接器会根据用户的语言环境展示不同的错误信息
参考：
{
 "zh":"出现异常",
 "en":"error happend",
}
异常时，填写错误信息，会透传到 Base 表格页面显示


data
object



-- tableName
string
是
1. max: 100 字符
2. 不包含特殊符号:/\?*[]: (若包含会自动去除)
数据源名，会作为 Base 表的表名，

-- fields
array object
是
min:1 ，max: 299 
对象数组，字段列表，会作为 Base 表的字段
-- -- fieldID
string
是
1. min:1 ，max: 50 
2. 只能包含 英文,数字,下划线
字段的唯一标识，保证同步表中唯一，用于与 Base 表的字段做 mapping

-- -- fieldName
string
是
1. max: 300 字符
2. 不包含这些特殊符号：[]
字段名称，会作为 Base 表字段的名称
-- -- fieldType

int

是
只允许枚举值
字段类型，可以取以下枚举值
1：多行文本
2：数字
3：单选
4：多选
5：日期
6: 条码
7：复选框
8: 货币
9：电话号码
10：超链接
11:  进度
12:  评分
13:  地理位置
-- -- isPrimary
bool

否
1. 有且有一个 field 的 isPrimary 是 true，其他都为 false
2. 只有多行文本，数字，日期，超链接，电话号码，条码，货币 可以设置为true 作为索引列
是否索引列，索引列会固定在表格第一列，且没法删除

-- -- description
string
否
max：1000
字段描述
-- -- property
object
否
只支持数字、货币、进度、评分、日期
各种字段类型的4.1 property 详细结构
response 示例
{
    "code": 0, // 0 代表成功，非0则是异常错误码
    "msg": "", // 异常时，填写错误信息
    "data": {
        "tableName":"xxx", // 表名
        "fields":[
            {
                "fieldID":"fid_1",// 字段唯一标识
                "fieldName":"id", // 字段名称
                "fieldType":1,  // 字段类型, 枚举值见下文
                "isPrimary":true, // 是否索引列
                "description": "xxx" // 字段描述   
            },
            {
                "fieldID":"fid_2",// 字段唯一标识
                "fieldName":"name", // 字段名称
                "fieldType":2,  // 字段类型, 枚举值见下文
                "isPrimary":false, // 是否索引列
                "description": "xxx" // 字段描述 
            }
        ]
    }
}
2.1.2.3 表记录接口
表记录接口 Node.js 版本的实现可参考 https://replit.com/@lark-base/data-sync-be-demo#table_records.js
接口协议
基本信息
说明
该接口返回 数据源的记录数据，分页请求，超时时间为 20 秒
方法
POST
URI
与 meta.json 中的 recordsURI 一致
超时限制
20 秒
demo地址
https://replit.com/@Feishu-Base/integration-test-demo#pages/api/records.ts
请求头
Key
value 描述
X-Base-Request-Timestamp

签名信息，详看下文「请求签名」逻辑


X-Base-Request-Nonce
签名信息，详看下文「请求签名」逻辑
Content-Type
固定值："application/json; charset=utf-8"
请求体
参数名
类型
描述
params
string
是一个 json 字符串，请求参数，结构如下：
{
  datasourceConfig: string，  // 用户在数据源配置页面选择的配置信息，也就是前端调用前端sdk bitable.saveConfigAndGoNext(configData: Record<string, any>)保存的信息，值由开发者定义，服务端在请求插件接口时透传

  transactionID:string，      // 同步事务 id，获取数据是分页获取，一次同步的多次请求 transactionID 相同
  pageToken:string，     // 请求首次请求为空，非首次请值为上一次请求返回的 nextPageToken
  maxPageSize: int，  // 最大可接受的 page_size，返回的记录数需要<=maxPageSize，插件可以根据记录的查询性能来确定返回多少记录。 接口超时时间为 20 秒
  }

context
string 

同 上文「3 表结构接口协议」请求体中的 context

请求体示例
{
  "params":"
  {
  \"datasourceConfig\":\"{\"xxx\":\"yyy\"}\",  
  \"transactionID\":\"xxxx\", 
  \"pageToken\":\"xxx\",
  \"maxPageSize\":1000
  }",
  "context": "{}"  
}
response
参数名
类型
是否必填
校验规则
描述
code
int
是

0 代表成功，非 0 则是异常错误码，规定的错误码场景：
1254400: 配置错误，即用户在配置面板选择的值不合法可以返回该错误码
1254403：用户访问权限异常
1254500：系统异常，插件运行错误
1254501：限流异常
1254505：付费错误异常
具体的错误信息，在msg 字段中返回
msg
string 
否
注意：msg 的格式为 json 字符串，里面需要包含 中英文的错误信息，当发生异常时，开发者需要同时返回这两种语言的信息，这样连接器会根据用户的语言环境展示不同的错误信息
参考：
{
 "zh":"出现异常",
 "en":"error happend",
}


异常时，填写错误信息，会透传到 Base 表格页面显示

data
object



-- nextPageToken
string

否
1. max:100 字符
2. 只能包含英文,数字,下划线
下一页 token
-- hasMore
bool
是

是否还有下一页
-- records
array object

记录数需要<=maxPageSize
对象数组，记录列表，每一条数据会作为 Base 表的一条记录
-- -- primaryID
string
是
1. max:100 字符
2. 只能包含英文,数字,下划线
主键 id，在同步表中能唯一标识一条记录
-- -- data

map<string,any>

是

1. key 必须是存在表结构接口中返回的response中包含的fieldID 的值
2. value 参考描述各字段的类型

记录数据， key 为对应的 fieldID，value 根据 field type 确定，对应关系如下：
多行文本：string
数字： float or int
单选： string
多选： string 数组
日期： int， unix 时间戳，单位毫秒
条码： string
复选框： bool
货币： float or int
电话号码： string（需所有字符都是数字）
超链接：  json 对象， 结构为{"name": string， "url": string}
进度：float or int
评分：int
地理位置：json 对象，结构为
{"latitude":float // 维度, "longitude":float // 经度}
response 示例
{
    "code": 0, 
    "msg": "", 
    "data": {
        "nextPageToken":"xxx", 
        "hasMore": false,
        "records":[
            {
                "primaryID":"1",
                "data": {
                    "fid_1": "xxx",
                    "fid_2": 1222,
                }  
            },
            {
                "primaryID":"2",
                "data": {
                    "fid_1": "xxx",
                    "fid_2": 334.33,
                }  
            }
        ]
    }
}
4. 附录
4.1 字段类型 property 结构
字段类型
property  
备注
数字
{
    "formatter":"0.0"
}
formatter 默认是保留1位小数，可选值有：
"0": 整数
"0.0": 保留1位小数
"0.00": 保留2位小数
"0.000": 保留3位小数
"0.0000": 保留4位小数
"#,##0":  千分位
"#,##0.00": 千分位(2位小数)
"0%": 百分比
"0.00%": 百分比(2位小数)
日期
{
    "formatter":"yyyy/MM/dd"
}

formatter 默认值yyyy/MM/dd，可选值：
"yyyy/MM/dd"
"yyyy-MM-dd"
"MM-dd"
"MM/dd/yyyy"
"dd/MM/yyyy"
"yyyy/MM/dd HH:mm"
"yyyy-MM-dd HH:mm"
货币
{
    "formatter":"0.0"
    "currencyCode":"CNY"
}
formatter 默认值保留2位小数，可选值：
"#,##0":      整数(千分位),
"#,##0.0":    保留1位小数(千分位),
"#,##0.00":   保留2位小数(千分位),
"#,##0.000":  保留3位小数(千分位),
"#,##0.0000": 保留4位小数(千分位),

currencyCode 默认值CNY，可选值:
"CNY": 人民币
"USD": 美元
"EUR": 欧元
"GBP": 英镑
"AED": 阿联酋迪拉姆
"AUD": 澳大利亚元
"BRL": 巴西雷亚尔
"CAD": 加拿大元
"CHF": 瑞士法郎
"HKD": 港元
"INR": 印度卢比
"IDR": 印尼盾
"JPY": 日元
"KRW": 韩元
"MOP": 澳门元
"MXN": 墨西哥比索
"MYR": 马来西亚令吉
"PHP": 菲律宾比索
"PLN": 波兰兹罗提
"RUB": 俄罗斯卢布
"SGD": 新加坡元
"THB": 泰国铢
"TRY": 土耳其里拉
"TWD": 新台币
"VND": 越南盾
进度
{
   "formatter":"0%"
   "min":0,
   "max":1,
   "color":0
}
formatter 默认0%，可选值：
0.00%: 百分比2位小数
0.0%: 百分比1位小数,
0%:  百分比,
0.00:  2位小数
0.0:   1位小数
0:    整数

color 进度条颜色，默认是0，可选值，具体效果在Base 进度字段中可见：
0-蓝色
1-紫色
2-深绿
3-绿色
4-青色
5-橙色
6-红色
7-墨黑
8-蓝色渐变
9-紫色渐变
10-橙色渐变
11-绿红
12-红绿
13-蓝粉
14-粉蓝
15-彩虹色

min 默认0， max 默认1，min 需要小于max，用于控制进度条的显示。
记录的值不会校验是否在min ~ max 之间，
如果值不在min~max 之间进度条无法正常显示

评分
{
   "symbol":"star"
   "max":5
}
symbol 图表，默认是⭐️(star),可选值：
star： ⭐️    
heart： ❤️  
thumbsup：👍
fire:  🔥   
smile:  😊  
lightning: ⚡️
flower: 🌷   
number: 🔢
 
 max默认5， 表示最高分，值范围是1～10
 记录的值不会校验是否在1 ~ max 之间，如果值不在1~max 之间评分无法显示